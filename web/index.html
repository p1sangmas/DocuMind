<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DocuMind - AI Knowledge Assistant</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" type="image/png" href="assets/favicon.png">
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <img src="assets/logo.png" alt="DocuMind Logo" class="logo">
                <h2>DocuMind</h2>
            </div>

            <div class="sidebar-section">
                <h3>üìÅ Document Management</h3>
                <div class="upload-container">
                    <label for="file-upload" class="upload-btn">
                        <i class="fas fa-file-pdf"></i> Upload PDF
                    </label>
                    <input type="file" id="file-upload" accept=".pdf" multiple>
                    <div id="selected-files-container" class="selected-files-container"></div>
                    <button id="process-docs-btn" class="primary-btn" disabled>Process Documents</button>
                </div>
            </div>

            <div class="sidebar-section">
                <h3>üìö Knowledge Base Status</h3>
                <div class="metric">
                    <span class="metric-label">Documents Indexed</span>
                    <span id="doc-count" class="metric-value">0</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Embedding Model</span>
                    <span id="embed-model" class="metric-value">all-MiniLM-L6-v2</span>
                </div>
            </div>

            <div class="sidebar-section" id="processed-docs-container">
                <h3>üìÑ Processed Documents</h3>
                <div id="processed-files-list" class="files-list"></div>
            </div>

            <div class="sidebar-section">
                <h3>üóÇÔ∏è Collection Management</h3>
                <div class="clear-kb-container">
                    <button id="clear-kb-btn" class="secondary-btn">Clear Knowledge Base</button>
                    <div id="confirm-clear" class="confirm-clear hidden">
                        <label>
                            <input type="checkbox" id="confirm-clear-checkbox">
                            I understand this will delete all documents
                        </label>
                        <button id="confirm-clear-btn" disabled class="danger-btn">Confirm Clear</button>
                    </div>
                </div>
            </div>

            <div class="sidebar-section">
                <h3>üîß System Status</h3>
                <div class="system-status">
                    <div class="status-item">
                        <span id="ollama-status" class="status-indicator"></span>
                        <span>Ollama</span>
                    </div>
                    <div class="status-item">
                        <span id="ocr-status" class="status-indicator"></span>
                        <span>OCR Support</span>
                    </div>
                </div>
                <div id="ollama-warning" class="status-warning hidden">
                    ‚ö†Ô∏è Ollama is not running. Please start Ollama with the llama3.1:8b model.
                    <button id="ollama-help-btn" class="text-btn">How to install Ollama</button>
                </div>
                <div id="ocr-warning" class="status-warning hidden">
                    ‚ÑπÔ∏è OCR support is not available.
                    <button id="ocr-help-btn" class="text-btn">How to enable OCR</button>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <div class="tabs">
                <button class="tab-btn active" data-tab="chat">üí¨ Chat</button>
                <button class="tab-btn" data-tab="analytics">üìä Analytics</button>
                <button class="tab-btn" data-tab="settings">‚öôÔ∏è Settings</button>
                <button class="tab-btn" data-tab="about">‚ÑπÔ∏è About</button>
            </div>

            <div class="tab-content">
                <!-- Chat Tab -->
                <div id="chat-tab" class="tab-pane active">
                    <div id="no-docs-warning" class="warning-box">
                        üìÑ No documents in knowledge base. Please upload some documents in the sidebar to get started.
                    </div>

                    <div id="chat-container" class="chat-container hidden">
                        <h3>üí¨ Conversation</h3>
                        <div id="chat-messages" class="chat-messages"></div>
                        
                        <div class="chat-input-container">
                            <input type="text" id="chat-input" placeholder="Ask a question about your documents...">
                            <button id="send-btn"><i class="fas fa-paper-plane"></i></button>
                        </div>
                    </div>
                </div>

                <!-- Analytics Tab -->
                <div id="analytics-tab" class="tab-pane">
                    <h3>üìä Analytics Dashboard</h3>
                    
                    <div class="metrics-grid">
                        <div class="metric-card">
                            <h4>Documents</h4>
                            <div id="analytics-doc-count" class="metric-value">0</div>
                        </div>
                        <div class="metric-card">
                            <h4>Conversations</h4>
                            <div id="conversation-count" class="metric-value">0</div>
                        </div>
                        <div class="metric-card">
                            <h4>Session ID</h4>
                            <div id="session-id" class="metric-value">-</div>
                        </div>
                    </div>

                    <h3>üìù Recent Feedback Analysis</h3>
                    <div id="feedback-analysis" class="metrics-container">
                        <div class="empty-state">No feedback data available yet.</div>
                    </div>

                    <h3>üñ•Ô∏è System Information</h3>
                    <div class="expandable-section">
                        <button class="expand-btn">View System Details</button>
                        <div class="expandable-content hidden">
                            <pre id="system-info" class="code-block"></pre>
                        </div>
                    </div>
                </div>

                <!-- Settings Tab -->
                <div id="settings-tab" class="tab-pane">
                    <h3>‚öôÔ∏è Settings</h3>
                    
                    <h4>ü§ñ Model Configuration</h4>
                    <div class="settings-grid">
                        <div class="settings-item">
                            <label>Embedding Model</label>
                            <input type="text" value="all-MiniLM-L6-v2" disabled>
                        </div>
                        <div class="settings-item">
                            <label>LLM Model</label>
                            <input type="text" value="llama3.1:8b" disabled>
                        </div>
                        <div class="settings-item">
                            <label>Semantic Weight</label>
                            <input type="range" min="0" max="1" step="0.1" value="0.7" disabled>
                            <span>0.7</span>
                        </div>
                        <div class="settings-item">
                            <label>Keyword Weight</label>
                            <input type="range" min="0" max="1" step="0.1" value="0.3" disabled>
                            <span>0.3</span>
                        </div>
                    </div>

                    <h4>‚úÇÔ∏è Text Chunking</h4>
                    <div class="settings-grid">
                        <div class="settings-item">
                            <label>Max Chunk Size</label>
                            <input type="range" min="500" max="2000" step="100" value="1000" disabled>
                            <span>1000</span>
                        </div>
                        <div class="settings-item">
                            <label>Chunk Overlap</label>
                            <input type="range" min="50" max="500" step="50" value="200" disabled>
                            <span>200</span>
                        </div>
                    </div>

                    <h4>üîß Advanced Settings</h4>
                    <div class="settings-grid">
                        <div class="settings-item checkbox">
                            <input type="checkbox" checked disabled>
                            <label>Auto-load documents from data/documents directory</label>
                            <span class="help-text">Enable/disable in settings.py</span>
                        </div>
                        <div class="settings-item checkbox">
                            <input type="checkbox" checked disabled>
                            <label>Skip existing documents when auto-loading</label>
                            <span class="help-text">Enable/disable in settings.py</span>
                        </div>
                    </div>

                    <div class="info-box">
                        To change auto-loading settings, edit the settings.py file and restart the application.
                    </div>

                    <div class="button-group">
                        <button id="export-conversation-btn" class="secondary-btn">Export Conversation History</button>
                        <button id="clear-conversation-btn" class="secondary-btn">Clear Conversation History</button>
                    </div>
                </div>

                <!-- About Tab -->
                <div id="about-tab" class="tab-pane">
                    <h3>‚ÑπÔ∏è About DocuMind</h3>
                    
                    <div class="about-content">
                        <p><strong>DocuMind</strong> is an AI-powered knowledge base assistant that transforms your static PDF documents into an interactive, searchable knowledge base. Ask questions in natural language and get contextual answers backed by your organizational documents.</p>
                        
                        <h4>üåü Key Features</h4>
                        <ul>
                            <li><strong>Multi-format PDF Processing</strong>: Robust text extraction with fallback mechanisms</li>
                            <li><strong>Semantic Search</strong>: Intelligent document retrieval using state-of-the-art embeddings</li>
                            <li><strong>Hybrid Retrieval</strong>: Combines semantic similarity with keyword matching</li>
                            <li><strong>Local AI</strong>: Uses Ollama for privacy-preserving, local AI inference</li>
                            <li><strong>Conversation Memory</strong>: Maintains context across multiple questions</li>
                            <li><strong>Source Attribution</strong>: Always shows which documents informed the answer</li>
                            <li><strong>Quality Evaluation</strong>: Built-in metrics to assess response quality</li>
                        </ul>
                        
                        <h4>üõ†Ô∏è Technology Stack</h4>
                        <ul>
                            <li><strong>Document Processing</strong>: PyPDF2, PyMuPDF, pdfplumber</li>
                            <li><strong>OCR Support</strong> (optional): pytesseract, pdf2image for handling problematic PDFs</li>
                            <li><strong>Embeddings</strong>: Sentence-Transformers (all-MiniLM-L6-v2)</li>
                            <li><strong>Vector Database</strong>: ChromaDB</li>
                            <li><strong>LLM</strong>: Ollama (Llama 3.1 8B)</li>
                            <li><strong>Frontend</strong>: HTML/CSS/JavaScript and Streamlit</li>
                            <li><strong>Evaluation</strong>: Custom RAGAS-inspired framework</li>
                        </ul>
                        
                        <h4>üöÄ Getting Started</h4>
                        <ol>
                            <li><strong>Setup</strong>: Ensure Ollama is running with the <code>llama3.1:8b</code> model</li>
                            <li><strong>Documents</strong>: Either place PDFs in the <code>data/documents</code> folder for auto-loading, or upload via the sidebar</li>
                            <li><strong>Process</strong>: For uploaded documents, click "Process Documents" to build your knowledge base</li>
                            <li><strong>Query</strong>: Start asking questions about your documents!</li>
                        </ol>
                        
                        <h4>üí° Tips for Best Results</h4>
                        <ul>
                            <li>Upload documents with clear, well-formatted text</li>
                            <li>Ask specific questions rather than very broad ones</li>
                            <li>Use the feedback system to help improve response quality</li>
                            <li>Check the confidence indicator to gauge answer reliability</li>
                        </ul>
                    </div>

                    <div class="expandable-section">
                        <button class="expand-btn">üîß Ollama Setup Guide</button>
                        <div class="expandable-content hidden">
                            <h4>Installing Ollama</h4>
                            <ol>
                                <li><strong>Download</strong>: Visit <a href="https://ollama.ai" target="_blank">ollama.ai</a> and download for your OS</li>
                                <li><strong>Install</strong>: Follow the installation instructions</li>
                                <li><strong>Pull Model</strong>: Run <code>ollama pull llama3.1:8b</code> in your terminal</li>
                                <li><strong>Verify</strong>: The model should start automatically</li>
                            </ol>
                            
                            <h4>Troubleshooting</h4>
                            <ul>
                                <li><strong>Service not running</strong>: Try <code>ollama serve</code> in terminal</li>
                                <li><strong>Model not found</strong>: Ensure you've pulled the correct model</li>
                                <li><strong>Memory issues</strong>: The 8B model requires ~8GB RAM</li>
                                <li><strong>Performance</strong>: Consider using a GPU for faster responses</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Modal Dialogs -->
        <div id="modal-overlay" class="modal-overlay hidden">
            <div id="ocr-help-modal" class="modal hidden">
                <div class="modal-header">
                    <h3>How to Enable OCR Support</h3>
                    <button class="close-modal-btn">&times;</button>
                </div>
                <div class="modal-content">
                    <h4>What is OCR?</h4>
                    <p>OCR (Optical Character Recognition) allows DocuMind to extract text from scanned PDFs or PDFs that don't have selectable text.</p>
                    
                    <h4>Installation Steps</h4>
                    <h5>1. Python Packages</h5>
                    <pre>pip install pytesseract pdf2image pillow</pre>
                    
                    <h5>2. System Dependencies</h5>
                    <h6>For macOS:</h6>
                    <pre>brew install tesseract poppler</pre>
                    
                    <h6>For Linux (Ubuntu/Debian):</h6>
                    <pre>sudo apt-get update
sudo apt-get install -y tesseract-ocr
sudo apt-get install -y poppler-utils</pre>
                    
                    <h6>For Windows:</h6>
                    <p>Download and install Tesseract from: <a href="https://github.com/UB-Mannheim/tesseract/wiki" target="_blank">https://github.com/UB-Mannheim/tesseract/wiki</a></p>
                    <p>Add Tesseract to your PATH</p>
                    <p>Install poppler for Windows: <a href="https://github.com/oschwartz10612/poppler-windows" target="_blank">https://github.com/oschwartz10612/poppler-windows</a></p>
                    
                    <h4>Verification</h4>
                    <p>After installation, restart the API server. OCR support should be automatically detected.</p>
                </div>
            </div>

            <div id="ollama-help-modal" class="modal hidden">
                <div class="modal-header">
                    <h3>How to Install Ollama</h3>
                    <button class="close-modal-btn">&times;</button>
                </div>
                <div class="modal-content">
                    <h4>Installation Steps</h4>
                    <h5>1. Download Ollama</h5>
                    <p>Visit <a href="https://ollama.ai" target="_blank">ollama.ai</a> to download the appropriate version for your operating system</p>
                    
                    <h5>2. Install Ollama</h5>
                    <p>Follow the installation instructions for your platform</p>
                    
                    <h5>3. Pull the required model</h5>
                    <pre>ollama pull llama3.1:8b</pre>
                    
                    <h5>4. Start the Ollama service</h5>
                    <pre>ollama serve</pre>
                    
                    <h4>Troubleshooting</h4>
                    <ul>
                        <li>Make sure Ollama is running in the background</li>
                        <li>Check that the correct model is installed using <code>ollama list</code></li>
                        <li>Verify there's enough RAM available (minimum 8GB recommended)</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script src="js/app.js"></script>
</body>
</html>
